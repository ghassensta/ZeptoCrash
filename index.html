<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ZeptoCrash - Jeu de Crash</title>

<!-- Lottie (renderer canvas) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>

<style>
  :root{
    --bg1:#0b1020; --bg2:#111a33; --acc1:#00d4ff; --acc2:#00ff88; --acc3:#ffaa00; --danger:#ff4444;
  }
  *{margin:0;padding:0;box-sizing:border-box}
  body{
    font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
    background:
      radial-gradient(1200px 600px at 90% -10%, #1f2a50 0%, transparent 60%),
      radial-gradient(900px 500px at 10% 110%, #142449 0%, transparent 60%),
      linear-gradient(135deg, #0f1224, #0b0f1f 70%, #090d1a);
    min-height:100vh;color:#fff;overflow-x:hidden
  }
  .container{max-width:1200px;margin:0 auto;padding:24px;min-height:100vh;display:grid;grid-template-rows:auto 1fr auto;gap:20px}
  .glass{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);backdrop-filter: blur(10px)}
  .header{ text-align:center; padding:22px 14px; border-radius:16px; position:relative }
  .header h1{font-size:2.4rem;color:var(--acc1);text-shadow:0 0 18px rgba(0,212,255,.35);letter-spacing:.5px}
  .header p{opacity:.9;margin-top:6px}
  .main-game{display:grid;grid-template-columns:2fr 1fr;gap:28px}

  .game-area{position:relative;border-radius:22px;padding:28px;overflow:hidden}
  /* Subtle grid glow background */
  .game-area::after{
    content:""; position:absolute; inset:0; pointer-events:none; opacity:.25;
    background-image:
      radial-gradient(rgba(255,255,255,.08) 1px, transparent 1px),
      radial-gradient(rgba(255,255,255,.06) 1px, transparent 1px);
    background-size:24px 24px, 48px 48px;
    background-position:0 0, 12px 12px;
    mix-blend-mode: screen;
  }

  .multiplier-display{text-align:center;margin-bottom:18px;position:relative;z-index:2}
  .multiplier{font-size:4.2rem;font-weight:900;color:var(--acc2);text-shadow:0 0 28px rgba(0,255,136,.55);letter-spacing:1px;transition:transform .1s ease}
  .multiplier.crashed{color:var(--danger);text-shadow:0 0 28px rgba(255,68,68,.6)}
  .game-status{font-size:1.05rem;margin-top:6px}
  .game-status.waiting{color:#ffd166}
  .game-status.playing{color:var(--acc2)}
  .game-status.crashed{color:var(--danger)}
  .progress-bar{width:100%;height:8px;background:rgba(255,255,255,.08);border-radius:8px;margin:16px 0;overflow:hidden}
  .progress-fill{height:100%;background:linear-gradient(90deg,var(--acc2),var(--acc1));width:0%;transition:width .08s linear}

  /* ROCKET LOTTIE LAYER */
  .rocket-layer{
    position:absolute; inset:0; pointer-events:none; z-index:1;
    display:flex; align-items:flex-end; justify-content:center;
    padding-bottom:40px;
  }
  .rocket-holder{ width:min(420px, 55%); max-height:60%; opacity:0; transform:translateY(40px) scale(.9);
    transition: opacity .35s ease, transform .35s ease; }
  .rocket-holder.show{ opacity:1; transform:translateY(0) scale(1) }

  .controls{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin:18px 0 8px}
  .control-group{border-radius:14px;padding:16px}
  .control-group h3{margin-bottom:10px;color:var(--acc1);font-size:1.05rem}
  .bet-controls{display:flex;flex-direction:column;gap:10px}
  .bet-amount{display:flex;align-items:center;gap:10px}
  .bet-input{flex:1;padding:12px 12px;border:1px solid rgba(255,255,255,.28);border-radius:10px;background:rgba(255,255,255,.08);color:#fff;font-size:1rem}
  .bet-input:focus{outline:none;border-color:var(--acc1);box-shadow:0 0 0 3px rgba(0,212,255,.20)}
  .quick-bets{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
  .quick-bet{padding:9px;border-radius:9px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.18);color:#fff;cursor:pointer;font-size:.92rem;transition:.25s}
  .quick-bet:hover{transform:translateY(-1px);background:rgba(0,212,255,.18);border-color:var(--acc1)}

  .game-button{width:100%;padding:14px 16px;font-size:1.05rem;font-weight:800;border:none;border-radius:12px;cursor:pointer;transition:transform .2s, box-shadow .2s;text-transform:uppercase;letter-spacing:.5px}
  .bet-button{background:linear-gradient(45deg,var(--acc2),var(--acc1));color:#061018}
  .cashout-button{background:linear-gradient(45deg,var(--acc3),#ff6a00);color:#1a0f06}
  .game-button:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 12px 24px rgba(0,0,0,.25)}
  .game-button:disabled{opacity:.55;cursor:not-allowed}

  .checkbox-group{display:flex;align-items:center;gap:10px;margin:8px 0}
  .checkbox{width:18px;height:18px}

  .sidebar{display:flex;flex-direction:column;gap:20px}
  .balance-card,.history-card{border-radius:16px;padding:18px}
  .balance-card h2{color:var(--acc1);margin-bottom:8px;text-align:center}
  .balance-amount{font-size:2rem;font-weight:900;text-align:center;color:var(--acc2);text-shadow:0 0 18px rgba(0,255,136,.4)}

  .history-card h3{color:var(--acc1);margin-bottom:10px;text-align:center}
  .history-list{max-height:340px;overflow-y:auto}
  .history-item{display:flex;justify-content:space-between;align-items:center;padding:10px;margin-bottom:8px;background:rgba(255,255,255,.06);border-radius:10px;border-left:4px solid}
  .history-item.win{border-left-color:var(--acc2)} .history-item.loss{border-left-color:var(--danger)}
  .history-multiplier{font-weight:800} .history-multiplier.win{color:var(--acc2)} .history-multiplier.loss{color:var(--danger)}

  .stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:14px;margin:12px 0 6px}
  .stat-item{text-align:center;padding:10px;background:rgba(255,255,255,.06);border-radius:10px}
  .stat-value{font-size:1.35rem;font-weight:800;color:var(--acc1)} .stat-label{font-size:.9rem;opacity:.8}

  .crash-animation{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:3rem;font-weight:900;color:var(--danger);text-shadow:0 0 30px rgba(255,68,68,.8);opacity:0;z-index:10;pointer-events:none}
  .crash-animation.show{animation:crashPulse 1.8s ease-out}
  @keyframes crashPulse{0%{opacity:0;transform:translate(-50%,-50%) scale(.6)}50%{opacity:1;transform:translate(-50%,-50%) scale(1.15)}100%{opacity:0;transform:translate(-50%,-50%) scale(1)}}

  /* Modals kept from your version, light polish */
  .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.8);backdrop-filter:blur(10px);display:flex;align-items:center;justify-content:center;z-index:1000;opacity:0;visibility:hidden;transition:.3s}
  .modal-overlay.show{opacity:1;visibility:visible}
  .modal{background:linear-gradient(145deg, rgba(255,255,255,.16), rgba(255,255,255,.07));border-radius:22px;padding:32px;text-align:center;border:2px solid rgba(255,255,255,.28);backdrop-filter:blur(20px);transform:scale(.7) translateY(40px);transition:.35s cubic-bezier(.34,1.56,.64,1);max-width:420px;width:92%}
  .modal-overlay.show .modal{transform:scale(1) translateY(0)}
  .modal-win{box-shadow:0 20px 44px rgba(0,255,136,.22)}
  .modal-lose{box-shadow:0 20px 44px rgba(255,68,68,.22)}
  .modal-title{font-size:2.1rem;font-weight:900;margin-bottom:8px}
  .modal-title.win{color:var(--acc2)} .modal-title.lose{color:var(--danger)}
  .modal-subtitle{opacity:.9;margin-bottom:10px}
  .modal-amount{font-size:1.8rem;font-weight:900;margin:10px 0 18px}
  .modal-amount.win{color:var(--acc2)} .modal-amount.lose{color:var(--danger)}
  .modal-details{background:rgba(255,255,255,.08);border-radius:14px;padding:14px;margin-bottom:16px}
  .modal-detail-row{display:flex;justify-content:space-between;margin:8px 0}
  .modal-detail-row:last-child{font-weight:800;color:var(--acc1);border-top:1px solid rgba(255,255,255,.2);padding-top:10px;margin-top:8px}
  .modal-close{background:linear-gradient(45deg,#666,#888);color:#fff;border:none;border-radius:10px;padding:12px 24px;font-weight:800;cursor:pointer}
  .footer{text-align:center;padding:18px;border-radius:16px}

  @media (max-width: 900px){ .main-game{grid-template-columns:1fr} .multiplier{font-size:3.2rem} .rocket-holder{width:70%} .header h1{font-size:2rem} }
</style>
</head>
<body>
  <div class="container">
    <header class="header glass">
      <h1>ðŸŽ® ZeptoCrash</h1>
      <p>Encaissez avant le crash pour multiplier vos gains !</p>
    </header>

    <main class="main-game">
      <div class="game-area glass" id="gameArea">
        <!-- MULTIPLIER / STATUS -->
        <div class="multiplier-display">
          <div class="multiplier" id="multiplier">1.00x</div>
          <div class="game-status" id="gameStatus">En attente de la prochaine manche...</div>
          <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
        </div>

        <!-- ROCKET LOTTIE CANVAS LAYER -->
        <div class="rocket-layer">
          <div class="rocket-holder" id="rocketHolder" data-rocket-json="ROCKET_LOTTIE_JSON_URL">
            <!-- Lottie (canvas) will be injected here -->
          </div>
        </div>

        <!-- CONTROLS -->
        <div class="controls">
          <div class="control-group glass">
            <h3>ðŸ’° Mise</h3>
            <div class="bet-controls">
              <div class="bet-amount">
                <input type="number" id="betAmount" class="bet-input" value="50" min="10" max="500" />
                <span>AED</span>
              </div>
              <div class="quick-bets">
                <button class="quick-bet" onclick="setBetAmount(10)">10</button>
                <button class="quick-bet" onclick="setBetAmount(50)">50</button>
                <button class="quick-bet" onclick="setBetAmount(100)">100</button>
              </div>
              <button id="betButton" class="game-button bet-button">Placer la mise</button>
            </div>
          </div>

          <div class="control-group glass">
            <h3>ðŸš€ Action</h3>
            <button id="cashoutButton" class="game-button cashout-button" disabled>Encaisser</button>
            <div class="auto-controls">
              <div class="checkbox-group">
                <input type="checkbox" id="autoCashout" class="checkbox" />
                <label for="autoCashout">Auto-encaissement Ã :</label>
              </div>
              <input type="number" id="autoCashoutValue" class="bet-input" value="2.00" min="1.01" max="10" step="0.01" disabled />
            </div>
          </div>
        </div>

        <!-- STATS -->
        <div class="stats">
          <div class="stat-item glass">
            <div class="stat-value" id="totalGames">0</div><div class="stat-label">Manches</div>
          </div>
          <div class="stat-item glass">
            <div class="stat-value" id="totalWins">0</div><div class="stat-label">Victoires</div>
          </div>
          <div class="stat-item glass">
            <div class="stat-value" id="winRate">0%</div><div class="stat-label">Taux de rÃ©ussite</div>
          </div>
          <div class="stat-item glass">
            <div class="stat-value" id="biggestWin">0</div><div class="stat-label">Plus gros gain</div>
          </div>
        </div>

        <div class="crash-animation" id="crashAnimation">ðŸ’¥ CRASH!</div>
        <div class="particles" id="particles"></div>
      </div>

      <aside class="sidebar">
        <div class="balance-card glass">
          <h2>ðŸ’³ Solde</h2>
          <div class="balance-amount" id="balance">1000 AED</div>
        </div>

        <div class="history-card glass">
          <h3>ðŸ“Š Historique</h3>
          <div class="history-list" id="historyList">
            <div style="text-align:center; opacity:.6; padding:20px;">Aucune manche jouÃ©e</div>
          </div>
        </div>
      </aside>
    </main>

    <footer class="footer glass">
      <p>ðŸŽ¯ RTP estimÃ©: ~75% | âš¡ Nouveau crash toutes les 10 secondes</p>
      <p style="margin-top:10px;opacity:.7">Prototype dÃ©veloppÃ© pour dÃ©monstration - Argent fictif uniquement</p>
    </footer>
  </div>

  <!-- WIN MODAL -->
  <div class="modal-overlay" id="winModal">
    <div class="modal modal-win">
      <div class="modal-icon" style="font-size:3rem">ðŸŽ‰</div>
      <h2 class="modal-title win">FÃ‰LICITATIONS!</h2>
      <p class="modal-subtitle">Vous avez encaissÃ© avec succÃ¨s!</p>
      <div class="modal-amount win" id="winAmount">+250 AED</div>
      <div class="modal-details">
        <div class="modal-detail-row"><span>Mise:</span><span id="winBetAmount">100 AED</span></div>
        <div class="modal-detail-row"><span>Multiplicateur:</span><span id="winMultiplier">2.50x</span></div>
        <div class="modal-detail-row"><span>Gain total:</span><span id="winTotalAmount">250 AED</span></div>
      </div>
      <button class="modal-close" onclick="closeModal('winModal')">Continuer</button>
    </div>
  </div>

  <!-- LOSE MODAL -->
  <div class="modal-overlay" id="loseModal">
    <div class="modal modal-lose">
      <div class="modal-icon" style="font-size:3rem">ðŸ’¥</div>
      <h2 class="modal-title lose">CRASH!</h2>
      <p class="modal-subtitle">Le crash est arrivÃ© trop tÃ´t...</p>
      <div class="modal-amount lose" id="loseAmount">-100 AED</div>
      <div class="modal-details">
        <div class="modal-detail-row"><span>Mise:</span><span id="loseBetAmount">100 AED</span></div>
        <div class="modal-detail-row"><span>Crash Ã :</span><span id="loseCrashPoint">1.45x</span></div>
        <div class="modal-detail-row"><span>Perte:</span><span id="loseTotalAmount">100 AED</span></div>
      </div>
      <button class="modal-close" onclick="closeModal('loseModal')">RÃ©essayer</button>
    </div>
  </div>

<script>
/* ----------------- Jeu (mÃªme logique que le tien, avec hooks Lottie) ----------------- */
class ZeptoCrashGame {
  constructor() {
    this.balance = 1000;
    this.currentBet = 0;
    this.currentMultiplier = 1.00;
    this.crashPoint = 0;
    this.gameState = 'waiting';
    this.multiplierInterval = null;
    this.startTime = 0;
    this.hasPlayerBet = false;
    this.hasCashedOut = false;

    this.stats = { totalGames:0,totalWins:0,totalLosses:0,biggestWin:0,totalWagered:0,totalWon:0 };
    this.history = [];

    this.lottie = { anim: null, holder: document.getElementById('rocketHolder') };

    this.initializeElements();
    this.initLottie();          // NEW
    this.startGameLoop();
  }

  initializeElements() {
    this.elements = {
      multiplier: document.getElementById('multiplier'),
      gameStatus: document.getElementById('gameStatus'),
      progressFill: document.getElementById('progressFill'),
      balance: document.getElementById('balance'),
      betAmount: document.getElementById('betAmount'),
      betButton: document.getElementById('betButton'),
      cashoutButton: document.getElementById('cashoutButton'),
      autoCashout: document.getElementById('autoCashout'),
      autoCashoutValue: document.getElementById('autoCashoutValue'),
      historyList: document.getElementById('historyList'),
      crashAnimation: document.getElementById('crashAnimation'),
      totalGames: document.getElementById('totalGames'),
      totalWins: document.getElementById('totalWins'),
      winRate: document.getElementById('winRate'),
      biggestWin: document.getElementById('biggestWin'),
      particles: document.getElementById('particles')
    };

    this.elements.betButton.addEventListener('click', ()=> this.placeBet());
    this.elements.cashoutButton.addEventListener('click', ()=> this.cashOut());
    this.elements.autoCashout.addEventListener('change', ()=> this.toggleAutoCashout());
    this.elements.betAmount.addEventListener('input', ()=> this.validateBetAmount());
  }

  /* ----------------- LOTTIE (canvas) ----------------- */
  initLottie(){
    const src = this.lottie.holder.getAttribute('data-rocket-json');
    if(!src || !window.lottie) return;
    this.lottie.anim = lottie.loadAnimation({
      container: this.lottie.holder,
      renderer: 'canvas',      // HTML5 canvas renderer
      loop: true,
      autoplay: false,
      path: src,
      rendererSettings: {
        clearCanvas: true,
        preserveAspectRatio: 'xMidYMid meet',
        progressiveLoad: true
      }
    });
  }
  showRocket(show=true){
    if(!this.lottie.anim) return;
    if(show){
      this.lottie.holder.classList.add('show');
      this.lottie.anim.goToAndStop(0,true);
      this.lottie.anim.play();
    }else{
      this.lottie.holder.classList.remove('show');
      this.lottie.anim.stop();
    }
  }

  generateCrashPoint() {
    const rand = Math.random();
    if (rand < 0.5) return 1.01 + Math.random() * 0.49;
    else if (rand < 0.8) return 1.50 + Math.random() * 1.50;
    else if (rand < 0.95) return 3.00 + Math.random() * 7.00;
    else return 10.00 + Math.random() * 90.00;
  }

  startGameLoop(){ this.newRound(); }

  newRound(){
    this.currentMultiplier = 1.00;
    this.crashPoint = this.generateCrashPoint();
    this.gameState = 'waiting';
    this.hasPlayerBet = false;
    this.hasCashedOut = false;
    this.startTime = 0;

    this.updateDisplay();
    this.enableBetting();
    this.showRocket(false); // cachÃ©e tant que pas de mise

    let countdown = 3;
    this.elements.gameStatus.textContent = `Nouvelle manche dans ${countdown}s...`;
    this.elements.gameStatus.className = 'game-status waiting';
    const countdownInterval = setInterval(()=>{
      countdown--;
      if(countdown>0){
        this.elements.gameStatus.textContent = `Nouvelle manche dans ${countdown}s...`;
      }else{
        clearInterval(countdownInterval);
        this.startRound();
      }
    },1000);
  }

  startRound(){
    this.gameState = 'playing';
    this.startTime = Date.now();
    this.elements.gameStatus.textContent = 'Manche en cours...';
    this.elements.gameStatus.className = 'game-status playing';
    this.elements.betButton.disabled = true;

    if (this.hasPlayerBet){
      this.elements.cashoutButton.disabled = false;
      this.showRocket(true);     // â–² fusÃ©e visible & animÃ©e
    }

    this.multiplierInterval = setInterval(()=>{
      this.updateMultiplier();

      if (this.hasPlayerBet && !this.hasCashedOut && 
          this.elements.autoCashout.checked && 
          this.currentMultiplier >= parseFloat(this.elements.autoCashoutValue.value)){
        this.cashOut();
      }
      if (this.currentMultiplier >= this.crashPoint){
        this.crash();
      }
    }, 50);
  }

  updateMultiplier(){
    const elapsed = Date.now() - this.startTime;
    this.currentMultiplier = 1 + (elapsed / 1000) * 0.1 + Math.pow(elapsed / 10000, 2);
    this.updateDisplay();
    const progress = Math.min((elapsed / 10000) * 100, 100);
    this.elements.progressFill.style.width = `${progress}%`;
  }

  placeBet(){
    const betAmount = parseInt(this.elements.betAmount.value);
    if (betAmount > this.balance) return alert('Solde insuffisant !');
    if (betAmount < 10) return alert('Mise minimum: 10 AED');

    this.currentBet = betAmount;
    this.balance -= betAmount;
    this.hasPlayerBet = true;
    this.stats.totalWagered += betAmount;

    this.updateDisplay();
    this.elements.betButton.disabled = true;
    this.elements.betButton.textContent = `Mise placÃ©e: ${betAmount} AED`;

    // PrÃ©-visualiser la fusÃ©e quand la mise est posÃ©e (avant start)
    this.showRocket(true);
  }

  cashOut(){
    if (!this.hasPlayerBet || this.hasCashedOut) return;
    this.hasCashedOut = true;
    const winAmount = Math.floor(this.currentBet * this.currentMultiplier);
    this.balance += winAmount;

    this.stats.totalWins++;
    this.stats.totalWon += winAmount;
    const profit = winAmount - this.currentBet;
    if (profit > this.stats.biggestWin) this.stats.biggestWin = profit;

    this.addToHistory(this.currentMultiplier, true, winAmount);
    this.updateDisplay();

    this.elements.cashoutButton.disabled = true;
    this.elements.gameStatus.textContent = `EncaissÃ©! Gain: ${winAmount} AED (${this.currentMultiplier.toFixed(2)}x)`;
    this.elements.gameStatus.className = 'game-status playing';

    this.showWinModal(this.currentBet, this.currentMultiplier, winAmount);
    this.createParticles('win');

    // Stopper la fusÃ©e Ã  lâ€™encaissement
    this.showRocket(false);
  }

  crash(){
    clearInterval(this.multiplierInterval);
    this.gameState = 'crashed';
    this.elements.multiplier.className = 'multiplier crashed';
    this.elements.gameStatus.textContent = `CRASH Ã  ${this.currentMultiplier.toFixed(2)}x!`;
    this.elements.gameStatus.className = 'game-status crashed';

    this.elements.crashAnimation.textContent = `ðŸ’¥ CRASH Ã  ${this.currentMultiplier.toFixed(2)}x!`;
    this.elements.crashAnimation.className = 'crash-animation show';
    setTimeout(()=>{ this.elements.crashAnimation.className = 'crash-animation'; }, 1800);

    if (this.hasPlayerBet && !this.hasCashedOut){
      this.stats.totalLosses++;
      this.addToHistory(this.currentMultiplier, false, this.currentBet);
      this.showLoseModal(this.currentBet, this.currentMultiplier);
      this.createParticles('lose');
    }

    this.stats.totalGames++;
    this.updateStats();

    // Stopper la fusÃ©e au crash
    this.showRocket(false);

    setTimeout(()=> this.newRound(), 4200);
  }

  showWinModal(betAmount, multiplier, winAmount){
    document.getElementById('winBetAmount').textContent = `${betAmount} AED`;
    document.getElementById('winMultiplier').textContent = `${multiplier.toFixed(2)}x`;
    document.getElementById('winAmount').textContent = `+${winAmount} AED`;
    document.getElementById('winTotalAmount').textContent = `${winAmount} AED`;
    document.getElementById('winModal').classList.add('show');
    setTimeout(()=> this.closeModal('winModal'), 3000);
  }

  showLoseModal(betAmount, crashPoint){
    document.getElementById('loseBetAmount').textContent = `${betAmount} AED`;
    document.getElementById('loseCrashPoint').textContent = `${crashPoint.toFixed(2)}x`;
    document.getElementById('loseAmount').textContent = `-${betAmount} AED`;
    document.getElementById('loseTotalAmount').textContent = `${betAmount} AED`;
    document.getElementById('loseModal').classList.add('show');
    setTimeout(()=> this.closeModal('loseModal'), 3000);
  }

  closeModal(id){ document.getElementById(id).classList.remove('show'); }

  createParticles(type){
    const n=20, c=this.elements.particles;
    for(let i=0;i<n;i++){
      const p=document.createElement('div');
      p.className=`particle ${type}`;
      const startX=c.offsetWidth/2, startY=c.offsetHeight/2;
      const angle=(Math.PI*2*i)/n, velocity=50+Math.random()*100;
      const dx=Math.cos(angle)*velocity, dy=Math.sin(angle)*velocity;
      p.style.position='absolute'; p.style.width='4px'; p.style.height='4px'; p.style.borderRadius='50%';
      p.style.background= type==='win' ? '#00ff88' : '#ff4444';
      p.style.left=`${startX}px`; p.style.top=`${startY}px`;
      p.style.opacity='0'; p.animate([
        {opacity:1, transform:`translate(0,0) scale(0)`},
        {opacity:1, transform:`translate(${dx}px, ${dy}px) scale(1)`},
        {opacity:0, transform:`translate(${dx*2}px, ${dy*2}px) scale(0)`}
      ], {duration:1200, easing:'ease-out'});
      c.appendChild(p);
      setTimeout(()=>p.remove(), 1300);
    }
  }

  addToHistory(multiplier, won, amount){
    const item = { multiplier, won, amount, timestamp: new Date() };
    this.history.unshift(item); if(this.history.length>10) this.history = this.history.slice(0,10);
    this.updateHistoryDisplay();
  }

  updateHistoryDisplay(){
    if(this.history.length===0){
      this.elements.historyList.innerHTML = `<div style="text-align:center;opacity:.6;padding:20px">Aucune manche jouÃ©e</div>`;
      return;
    }
    this.elements.historyList.innerHTML = this.history.map(item => `
      <div class="history-item ${item.won?'win':'loss'}">
        <div>
          <div class="history-multiplier ${item.won?'win':'loss'}">${item.multiplier.toFixed(2)}x</div>
          <div style="font-size:.8rem;opacity:.8">${item.timestamp.toLocaleTimeString()}</div>
        </div>
        <div>
          <div style="font-weight:800;color:${item.won?'#00ff88':'#ff4444'}">
            ${item.won?'+':'-'}${item.amount} AED
          </div>
          <div style="font-size:.8rem;opacity:.8">${item.won?'Gain':'Perte'}</div>
        </div>
      </div>`).join('');
  }

  updateStats(){
    const total=this.stats.totalWins+this.stats.totalLosses;
    const rate = total>0 ? Math.round((this.stats.totalWins/total)*100) : 0;
    this.elements.totalGames.textContent = total;
    this.elements.totalWins.textContent = this.stats.totalWins;
    this.elements.winRate.textContent = `${rate}%`;
    this.elements.biggestWin.textContent = `${this.stats.biggestWin} AED`;
  }

  updateDisplay(){
    this.elements.multiplier.textContent = `${this.currentMultiplier.toFixed(2)}x`;
    this.elements.balance.textContent = `${this.balance} AED`;
    if(this.gameState!=='crashed'){ this.elements.multiplier.className='multiplier'; }
  }
  enableBetting(){
    this.elements.betButton.disabled = false;
    this.elements.betButton.textContent = 'Placer la mise';
    this.elements.cashoutButton.disabled = true;
  }
  validateBetAmount(){
    const amount = parseInt(this.elements.betAmount.value);
    if(amount > this.balance) this.elements.betAmount.value = this.balance;
    if(amount < 10) this.elements.betAmount.value = 10;
  }
  toggleAutoCashout(){
    this.elements.autoCashoutValue.disabled = !this.elements.autoCashout.checked;
  }
}

/* Quick bet global */
function setBetAmount(v){ document.getElementById('betAmount').value = v; }
/* Close modal global */
function closeModal(id){ document.getElementById(id).classList.remove('show'); }

/* Boot */
let game;
window.addEventListener('load', ()=>{ game = new ZeptoCrashGame(); });
document.addEventListener('click', (e)=>{ if(e.target.classList.contains('modal-overlay')) e.target.classList.remove('show'); });
document.addEventListener('keydown', (e)=>{ if(e.key==='Escape'){ document.querySelectorAll('.modal-overlay.show').forEach(m=>m.classList.remove('show')); }});
</script>
</body>
</html>
